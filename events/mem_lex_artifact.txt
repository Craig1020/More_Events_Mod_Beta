namespace = mem_artifact

#Shroudtech ship abilities

country_event = {
	id = mem_artifact.1
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			OR = {
				is_ship_size = mem_artifact_station
				is_ship_size = mem_artifact_ship
			}
		}
	}
	
	immediate = {
		FROMFROMFROM = {
			if = {
				limit = {
					exists = this
				}
				save_event_target_as = mem_artifact_bomb_loc
				else = {
					FROMFROM = {
						save_event_target_as = mem_artifact_bomb_loc
					}
				}
			}
		}
		FROMFROM = {
			save_event_target_as = mem_artifact_ship_loc
			owner = {
				save_event_target_as = mem_artifact_ship_owner
			}
			random_list = {
				20 = {
					add_modifier = {
						modifier = "mem_artifact_ship_power_1"
						days = 90
					}
				}
				20 = {
					add_modifier = {
						modifier = "mem_artifact_ship_power_2"
						days = 90
					}
				}
				20 = {
					add_modifier = {
						modifier = "mem_artifact_ship_power_3"
						days = 90
					}
				}
				20 = {
					add_modifier = {
						modifier = "mem_artifact_ship_power_4"
						days = 90
					}
				}
				20 = {
					add_modifier = {
						modifier = "mem_artifact_ship_power_5"
						days = 90
					}
				}
			}
			if = {
				limit = {
					has_modifier = mem_artifact_ship_power_1
				}
				random_list = {
					50 = {
					}
					50 = {
						remove_modifier = "mem_artifact_ship_power_1"
						create_fleet = {
							name = "Psionic Projection"
							settings = {
								spawn_debris = no
								is_boss = yes
							}
							effect = {
								set_owner = event_target:mem_artifact_ship_owner
								create_ship = {
									name = "Vic'Inta"
									design = "Av'Rta I"
									prefix = no
								}
								set_location = event_target:mem_artifact_ship_loc
								set_fleet_stance = aggressive
								set_aggro_range = 500
								set_aggro_range_measure_from = self
								
								fleet_event = { id = mem_artifact.2 days = 60 }
							}
						}
					}
				}
			}
			if = {
				limit = {
					has_modifier = mem_artifact_ship_power_2
				}
				random_list = {
					50 = {
					}
					50 = {
						remove_modifier = "mem_artifact_ship_power_2"
						create_fleet = {
							name = "Psionic Projection"
							settings = {
								spawn_debris = no
								is_boss = yes
							}
							effect = {
								set_owner = event_target:mem_artifact_ship_owner
								create_ship = {
									name = "Prat'Ibha"
									design = "Av'Rta II"
									prefix = no
								}
								set_location = event_target:mem_artifact_ship_loc
								
								set_fleet_stance = aggressive
								set_aggro_range = 500
								set_aggro_range_measure_from = self
								
								fleet_event = { id = mem_artifact.2 days = 60 }
							}
						}
					}
				}
			}
			if = {
				limit = {
					has_modifier = mem_artifact_ship_power_3
				}
				random_list = {
					50 = {
					}
					50 = {
						remove_modifier = "mem_artifact_ship_power_3"
						create_fleet = {
							name = "Psionic Projection"
							settings = {
								spawn_debris = no 
								is_boss = yes
							}
							effect = {
								set_owner = event_target:mem_artifact_ship_owner
								create_ship = {
									name = "Zun'Yata"
									design = "Nir'Rti I"
									prefix = no
								}
								set_location = event_target:mem_artifact_bomb_loc

								fleet_event = { id = mem_artifact.2 days = 1 }
								
								set_event_locked = yes
							}
						}
					}
				}
			}
			if = {
				limit = {
					has_modifier = mem_artifact_ship_power_4
				}
				random_list = {
					50 = {
					}
					50 = {
						remove_modifier = "mem_artifact_ship_power_4"
						create_fleet = {
							name = "Psionic Projection"
							settings = {
								spawn_debris = no 
								is_boss = yes
							}
							effect = {
								set_owner = event_target:mem_artifact_ship_owner
								create_ship = {
									name = "Val'Ukatva"
									design = "Nir'Rti II"
									prefix = no
								}
								set_location = event_target:mem_artifact_bomb_loc

								fleet_event = { id = mem_artifact.2 days = 1 }
								
								set_event_locked = yes
							}
						}
					}
				}
			}
			if = {
				limit = {
					has_modifier = mem_artifact_ship_power_5
				}
				random_list = {
					50 = {
					}
					50 = {
						remove_modifier = "mem_artifact_ship_power_5"
						add_modifier = {
							modifier = "mem_artifact_ship_repair"
							days = 30
						}
						repair_ship = yes
					}
				}
			}
		}
	}
}

#Disband Drones

fleet_event = {
	id = mem_artifact.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		destroy_fleet = THIS
	}
}

#Player System Buster Type 2

country_event = {
	id = mem_artifact.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROMFROM = {
			is_ship_size = mem_artifact_bomb_2
		}
	}
	
	immediate = {
		FROMFROMFROM = {
			OWNER = {
				save_event_target_as = mem_artifact_bomb_2_owner
			}
		}
		FROMFROM = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_star = yes 
					}
					save_event_target_as = mem_artifact_bomb_2_loc
					mem_effect_explosion_AOE = yes
					create_ambient_object = {
					type = "mem_cloud_ambient_object"
					location = this
					duration = 1800
					}
				}
				every_system_planet = {
					if = {
						limit = {
							exists = this
							is_star = no 
						}
						if = {
							limit = {
								OR = {
									habitable_planet = yes
									habitable_structure = yes
								}
								NOT = {
									has_modifier = mem_artifact_bomb_2_planet_effect
								}
							}
							add_modifier = {
								modifier = "mem_artifact_bomb_2_planet_effect"
								days = 1800
							}
						}
						if = {
							limit = {
								has_army = yes
							}
							while = {
								limit = {
									has_army = yes
								}
								random_planet_army = {
									remove_army = yes
								}
							}
						}
						every_tile = {
							if = {
								limit = {
									OR = {
										has_grown_pop = yes
										has_growing_pop = yes
									}
								}
								kill_pop = yes
							}
							if = {
								limit = {
									has_building = yes
									is_ruined = no
								}
								set_ruined = yes
							}
						}
					}
				}
				set_timed_star_flag = { flag = mem_artifact_bomb_2_debuff days = 1800 }
			}
		}
		create_fleet = {
			name = "Psionic Projection"
			settings = {
				spawn_debris = no 
				is_boss = yes
			}
			effect = {
				set_owner = event_target:mem_artifact_bomb_2_owner
				create_ship = {
					name = "Ab'Hu"
					design = "Nir'Rti III"
					prefix = no
				}
				set_location = event_target:mem_artifact_bomb_2_loc

				fleet_event = { id = mem_artifact.8 days = 1 }
				
				set_event_locked = yes
			}
		}
		every_country = {
			limit = {
				has_communications = event_target:mem_artifact_bomb_2_owner
				NOT = {
					is_country = event_target:mem_artifact_bomb_2_owner
					has_ai_personality_behaviour = purger
				}
				OR = {
					is_country_type = default
					has_ai_personality = awakened_fallen_empire_xenophile				
				}	
			}
			add_opinion_modifier = { who = event_target:mem_artifact_bomb_2_owner modifier = opinion_genocidal }
		}
		add_threat = {
			who = event_target:mem_artifact_bomb_2_owner
			amount = 100
		}
	}
}

#Player System Buster Type 1

country_event = {
	id = mem_artifact.4
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROMFROM = {
			is_ship_size = mem_artifact_bomb_1
		}
	}
	
	immediate = {
		FROMFROMFROM = {
			OWNER = {
				save_event_target_as = mem_artifact_bomb_1_owner
			}
		}
		FROMFROM = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_star = yes 
					}
					save_event_target_as = mem_artifact_bomb_1_loc
					mem_effect_explosion_AOE = yes
					last_created_ambient_object = {
						set_ambient_object_flag = mem_artifact_bomb_1_explosion_ambient
					}
					create_ambient_object = {
					type = "mem_cloud_ambient_object"
					duration = 1800
					location = this
					}
					last_created_ambient_object = {
						set_ambient_object_flag = mem_artifact_bomb_1_fog_1
					}
					create_ambient_object = {
					type = "mem_cloud_ambient_alt_object"
					duration = 1800
					location = this
					}
					last_created_ambient_object = {
						set_ambient_object_flag = mem_artifact_bomb_1_fog_2
					}
					if = {
						limit = {
							NOT = {
								is_planet_class = pc_mem_star_dummy
							}
						}
						prevent_anomaly = yes
						orbital_deposit_tile = {
							clear_deposits = yes
						}
						change_pc = pc_mem_star_dummy
					}
				}
				every_system_planet = {
					if = {
						limit = {
							exists = this
							is_star = no
						}
						if = {
							limit = {
								has_army = yes
							}
							while = {
								limit = {
									has_army = yes
								}
								random_planet_army = {
									remove_army = yes
								}
							}
						}
						every_tile = {
							if = {
								limit = {
									OR = {
										has_grown_pop = yes
										has_growing_pop = yes
									}
								}
								kill_pop = yes
							}
						}
						remove_planet = yes 
					}
				}
				every_system_ambient_object = {
					if = {
						limit = {
							exists = this
							NOR = {
								has_ambient_object_flag = mem_artifact_bomb_1_fog_1
								has_ambient_object_flag = mem_artifact_bomb_1_fog_2
								has_ambient_object_flag = mem_artifact_bomb_1_explosion_ambient
							}
						}
						destroy_ambient_object = this
					}
				}
				set_timed_star_flag = { flag = mem_artifact_bomb_1_debuff days = 1800 }
			}
		}
		create_fleet = {
			name = "Psionic Projection"
			settings = {
				spawn_debris = no 
				is_boss = yes
			}
			effect = {
				set_owner = event_target:mem_artifact_bomb_1_owner
				create_ship = {
					name = "Va'Zin"
					design = "Nir'Rti IV"
					prefix = no
				}
				set_location = event_target:mem_artifact_bomb_1_loc

				fleet_event = { id = mem_artifact.7 days = 1 }
				
				set_event_locked = yes
			}
		}
		every_country = {
			limit = {
				has_communications = event_target:mem_artifact_bomb_1_owner
				NOT = {
					is_country = event_target:mem_artifact_bomb_1_owner
					has_ai_personality_behaviour = purger
				}
				OR = {
					is_country_type = default
					has_ai_personality = awakened_fallen_empire_xenophile				
				}	
			}
			add_opinion_modifier = { who = event_target:mem_artifact_bomb_1_owner modifier = opinion_genocidal }
		}
		add_threat = {
			who = event_target:mem_artifact_bomb_1_owner
			amount = 100
		}
	}
}

#Player System Buster Type 2 - Debuff

event = {
	id = mem_artifact.5
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_system = {
			has_star_flag = mem_artifact_bomb_2_debuff
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_artifact_bomb_2_debuff
			}
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
					}
					add_modifier = {
						modifier = "mem_artifact_bomb_2_debuff_effect"
						days = 30
					}
				}
			}
		}
	}
}

#Player System Buster Type 1 - Debuff

event = {
	id = mem_artifact.6
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_system = {
			has_star_flag = mem_artifact_bomb_1_debuff
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_artifact_bomb_1_debuff
			}
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
					}
					add_modifier = {
						modifier = "mem_artifact_bomb_1_debuff_effect"
						days = 30
					}
				}
			}
		}
	}
}

#Player System Buster Type 1 - Surviving ships get crippled

fleet_event = {
	id = mem_artifact.7
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		destroy_fleet = THIS
		solar_system = {
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
					}
					add_modifier = {
						modifier = "mem_artifact_bomb_1_temp"
						days = 1800
					}
				}
			}
		}
	}
}

#Player System Buster Type 2 - Surviving ships get crippled

fleet_event = {
	id = mem_artifact.8
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		destroy_fleet = THIS
		solar_system = {
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
					}
					add_modifier = {
						modifier = "mem_artifact_bomb_2_temp"
						days = 1800
					}
				}
			}
		}
	}
}

# Beautiful Erasure - End of Days

planet_event = {
	id = mem_artifact.9
	hide_window = yes
	
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = {
					is_star = yes 
				}
				mem_effect_explosion_AOE = yes
				last_created_ambient_object = {
					set_ambient_object_flag = mem_artifact_doom_ambient
				}
				create_ambient_object = {
				type = "mem_cloud_ambient_object"
				location = this
				}
				last_created_ambient_object = {
					set_ambient_object_flag = mem_artifact_doom_fog_1
				}
				create_ambient_object = {
				type = "mem_cloud_ambient_alt_object"
				location = this
				}
				last_created_ambient_object = {
					set_ambient_object_flag = mem_artifact_doom_fog_2
				}
			}
			every_system_planet = {
				if = {
					limit = {
						exists = this
					}
					if = {
						limit = {
							has_army = yes
						}
						while = {
							limit = {
								has_army = yes
							}
							random_planet_army = {
								remove_army = yes
							}
						}
					}
					every_tile = {
						if = {
							limit = {
								OR = {
									has_grown_pop = yes
									has_growing_pop = yes
								}
							}
							kill_pop = yes
						}
					}
					remove_planet = yes 
				}
			}
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
					}
					destroy_fleet = THIS
				}
			}
			every_system_ambient_object = {
				if = {
					limit = {
						exists = this
						NOR = {
							has_ambient_object_flag = mem_artifact_doom_ambient
							has_ambient_object_flag = mem_artifact_doom_fog_1
							has_ambient_object_flag = mem_artifact_doom_fog_2
						}
					}
					destroy_ambient_object = this
				}
			}
			set_star_flag = mem_artifact_doom_flag
			random_system = {
				limit = {
					NOT = {
						has_star_flag = mem_artifact_doom_flag
					}
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					planet_event = { id = mem_artifact.9 days = 30 }
				}
			}
		}
	}
}

# Cipher 1 Power

country_event = {
	id = mem_artifact.10
	hide_window = yes
	
	trigger = {
		NOT = {
			has_modifier = mem_cipher_1_power
		}
		any_owned_ship = {
			AND = {
				has_ship_flag = mem_artifact_cipher_1
				is_ship_size = mem_artifact_cipher
			}
		}
	}
	
	immediate = {
		add_modifier = {
			modifier = mem_cipher_1_power
			days = -1
		}
	}
}

# Cipher 2 Power

country_event = {
	id = mem_artifact.11
	hide_window = yes
	
	trigger = {
		NOT = {
			has_modifier = mem_cipher_2_power
		}
		any_owned_ship = {
			AND = {
				has_ship_flag = mem_artifact_cipher_2
				is_ship_size = mem_artifact_cipher
			}
		}
	}
	
	immediate = {
		add_modifier = {
			modifier = mem_cipher_2_power
			days = -1
		}
	}
}

# Cipher 3 Power

country_event = {
	id = mem_artifact.12
	hide_window = yes
	
	trigger = {
		NOT = {
			has_modifier = mem_cipher_3_power
		}
		any_owned_ship = {
			AND = {
				has_ship_flag = mem_artifact_cipher_3
				is_ship_size = mem_artifact_cipher
			}
		}
	}
	
	immediate = {
		add_modifier = {
			modifier = mem_cipher_3_power
			days = -1
		}
	}
}

# Full Cipher Power

country_event = {
	id = mem_artifact.13
	hide_window = yes
	
	trigger = {
		NOT = {
			has_modifier = mem_cipher_full_power
		}
		any_owned_ship = {
			AND = {
				has_ship_flag = mem_artifact_cipher_4
				is_ship_size = mem_artifact_cipher_alt
			}
		}
	}
	
	immediate = {
		add_modifier = {
			modifier = mem_cipher_full_power
			days = -1
		}
	}
}

# Cipher 1 Lost

country_event = {
	id = mem_artifact.14
	hide_window = yes
	
	trigger = {
		has_modifier = mem_cipher_1_power
		NOT = {
			any_owned_ship = {
				AND = {
					has_ship_flag = mem_artifact_cipher_1
					is_ship_size = mem_artifact_cipher
				}
			}
		}
	}
	
	immediate = {
		remove_modifier = mem_cipher_1_power
	}
}

# Cipher 2 Lost

country_event = {
	id = mem_artifact.15
	hide_window = yes
	
	trigger = {
		has_modifier = mem_cipher_2_power
		NOT = {
			any_owned_ship = {
				AND = {
					has_ship_flag = mem_artifact_cipher_2
					is_ship_size = mem_artifact_cipher
				}
			}
		}
	}
	
	immediate = {
		remove_modifier = mem_cipher_2_power
	}
}

# Cipher 3 Lost

country_event = {
	id = mem_artifact.16
	hide_window = yes
	
	trigger = {
		has_modifier = mem_cipher_3_power
		NOT = {
			any_owned_ship = {
				AND = {
					has_ship_flag = mem_artifact_cipher_3
					is_ship_size = mem_artifact_cipher
				}
			}
		}
	}
	
	immediate = {
		remove_modifier = mem_cipher_3_power
	}
}

# Cipher 4 Lost

country_event = {
	id = mem_artifact.17
	hide_window = yes
	
	trigger = {
		has_modifier = mem_cipher_full_power
		NOT = {
			any_owned_ship = {
				AND = {
					has_ship_flag = mem_artifact_cipher_4
					is_ship_size = mem_artifact_cipher_alt
				}
			}
		}
	}
	
	immediate = {
		remove_modifier = mem_cipher_full_power
	}
}

# Cipher 1 Activated

ship_event = {
	id = mem_artifact.18
	hide_window = yes
	
	mean_time_to_happen = {
		days = 60
	}
	
	trigger ={
		is_ship_size = mem_artifact_cipher
		has_ship_flag = mem_artifact_cipher_1
		solar_system = {
			has_star_flag = mem_gate_system
		}
		NOT = {
			has_global_flag = Cipher_1_activation
		}
	}
	
	immediate = {
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = mem_artifact.19 days = 10 }
		}
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_gate_stone_1
				}
				create_ambient_object = {
				type = "mem_artifact_cipher_object"
				scale = 5
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_cipher_1_ambient
				}
			}
		}
		fleet = {
			delete_fleet = this
		}
		set_global_flag = Cipher_1_activation
	}
}

# Cipher 1 Activation Notification

country_event = {
	id = mem_artifact.19
	title = "mem_artifact.19"
	desc = "mem_artifact.19.desc"
	picture = GFX_evt_space_station

	is_triggered_only = yes
	
	trigger =  {
	}
	
	immediate = {
	}
	
	option = {
	}
}

# Cipher 2 Activated

ship_event = {
	id = mem_artifact.20
	hide_window = yes
	
	mean_time_to_happen = {
		days = 60
	}
	
	trigger ={
		is_ship_size = mem_artifact_cipher
		has_ship_flag = mem_artifact_cipher_2
		solar_system = {
			has_star_flag = mem_gate_system
		}
		NOT = {
			has_global_flag = Cipher_2_activation
		}
	}
	
	immediate = {
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = mem_artifact.21 days = 10 }
		}
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_gate_stone_2
				}
				create_ambient_object = {
				type = "mem_artifact_cipher_object"
				scale = 5
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_cipher_2_ambient
				}
			}
		}
		fleet = {
			delete_fleet = this
		}
		set_global_flag = Cipher_2_activation
	}
}

# Cipher 2 Activation Notification

country_event = {
	id = mem_artifact.21
	title = "mem_artifact.21"
	desc = "mem_artifact.21.desc"
	picture = GFX_evt_space_station

	is_triggered_only = yes
	
	trigger =  {
	}
	
	immediate = {
	}
	
	option = {
	}
}

# Cipher 3 Activated

ship_event = {
	id = mem_artifact.22
	hide_window = yes
	
	mean_time_to_happen = {
		days = 60
	}
	
	trigger ={
		is_ship_size = mem_artifact_cipher
		has_ship_flag = mem_artifact_cipher_3
		solar_system = {
			has_star_flag = mem_gate_system
		}
		NOT = {
			has_global_flag = Cipher_3_activation
		}
	}
	
	immediate = {
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = mem_artifact.23 days = 10 }
		}
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_gate_stone_3
				}
				create_ambient_object = {
				type = "mem_artifact_cipher_object"
				scale = 5
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_cipher_3_ambient
				}
			}
		}
		fleet = {
			delete_fleet = this
		}
		set_global_flag = Cipher_3_activation
	}
}

# Cipher 3 Activation Notification

country_event = {
	id = mem_artifact.23
	title = "mem_artifact.23"
	desc = "mem_artifact.23.desc"
	picture = GFX_evt_space_station

	is_triggered_only = yes
	
	trigger =  {
	}
	
	immediate = {
	}
	
	option = {
	}
}

#Galaxy Buster - Remote Trigger

country_event = {
	id = mem_artifact.24
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = mem_artifact_endtime
		}
		any_owned_ship = {
			is_ship_size = mem_artifact_relic_frame
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				any_ship_in_system = {
					is_ship_size = mem_artifact_relic_frame
				}
			}
			random_system_planet = {
				limit = {
					is_star = yes
				}
				planet_event = { id = mem_artifact.9 }
			}
		}
		every_owned_ship = {
			limit = {
				is_ship_size = mem_artifact_relic_frame
			}
			fleet = {
				destroy_fleet = THIS
			}
		}
		set_global_flag = mem_artifact_endtime
	}
}

#Galaxy Buster - Relic destroyed

country_event = {
	id = mem_artifact.25
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROMFROM = {
			is_ship_size = mem_artifact_relic_frame
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_flag = mem_artifact_endtime
				}
			}
			FROMFROM = {
				solar_system = {
					random_system_planet = {
						limit = {
							is_star = yes
						}
						planet_event = { id = mem_artifact.9 }
					}
				}
			}
			set_global_flag = mem_artifact_endtime
		}
	}
}

#Entering System

ship_event = {
	id = mem_artifact.50
	title = "mem_artifact.50"
	desc = "mem_artifact.50.desc"
	picture = GFX_evt_space_station
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
	    NOT = { has_global_flag = mem_artifact_awakening }
		owner = {
			NOT = {
				has_country_flag = encountered_mem_artifact 
			}
			is_ai = no
		}
		FROM = {
			has_star_flag = mem_gate_system
		}
	}
	
	immediate = {
		FROM = {
			every_system_planet = {
				limit = {
					has_planet_flag = mem_gate_shrouded
				}
				save_event_target_as = mem_gate_planet
			}
		}
		owner = {
			set_country_flag = encountered_mem_artifact
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "mem_lex_gate_chain" 
				}
				end_event_chain = "mem_lex_gate_chain"
			}
		}
	}		
	
	option = {
		name = "mem_artifact.50.a"
	}
}

#Sensor Calibration

ship_event = {
	id = mem_artifact.51
	title = "mem_artifact.51"
	desc = "mem_artifact.51.desc"
	picture = GFX_evt_space_station
	location = THIS
	
	trigger = {
		owner = {
			is_ai = no
			has_technology = "tech_sensors_3"
			has_country_flag = encountered_mem_artifact
			NOT = {
				has_country_flag = mem_artifact_sensor_calibrate
			}
		}
		solar_system = {
			has_star_flag = mem_gate_system
		}
	}
	
	mean_time_to_happen = {
		years = 10

		modifier = {
			factor = 0.1
			owner = {
				has_technology = "tech_sensors_4"
			}
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = mem_gate_shrouded
				}
				save_event_target_as = mem_gate_planet
			}
		}
		owner = {
			set_country_flag = mem_artifact_sensor_calibrate
		}
	}
	
	option = {
		name = "mem_artifact.51.a"
		event_target:mem_gate_planet = {
			enable_special_project = {
				name = "MEM_GATE_EXPLORE"
				location = THIS
				owner = ROOT
			}
		}
	}
}

#Station Explored - Choice

ship_event = {
	id = mem_artifact.52
	title = "mem_artifact.52"
	desc = "mem_artifact.52.desc"
	picture = GFX_evt_space_station
	location = THIS
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			NOT = {
				has_country_flag = mem_artifact_station_expedition
			}
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			random_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_relic_alt_target
				}
				save_event_target_as = mem_artifact_relic_explore
			}
		}
		owner = {
			set_country_flag = mem_artifact_station_expedition
		}
	}
	
	option = {
		name = mem_artifact.52.a
	}
	
	option = {
		name = mem_artifact.52.b
		event_target:mem_artifact_relic_explore = {
			enable_special_project = {
				name = "MEM_RELIC_ACCESS"
				location = this
				owner = ROOT
			}
		}
	}
}

#Relic Forceful Access - Choice

ship_event = {
	id = mem_artifact.53
	title = "mem_artifact.53"
	desc = "mem_artifact.53.desc"
	picture = GFX_evt_space_station
	location = THIS
	
	is_triggered_only = yes
	
	trigger = {
	}
	
	immediate = {
	}
	
	option = {
		name = mem_artifact.53.a
		hidden_effect = {
			random_system = {
				limit = {
					has_star_flag = mem_gate_system
				}
				every_system_ambient_object = {
					limit = {
						has_ambient_object_flag = mem_artifact_relic_alt_target
					}
					create_ambient_object = {
					type = "mem_artifact_relic_alt_2_object"
					}
					last_created_ambient_object = {
						set_location = {
							target = this
							distance = 0
							angle = 0
						}
						set_ambient_object_flag = mem_artifact_relic_alt_2_target
					}
					destroy_ambient_object = this
				}
			}
			owner = {
				country_event = { id = mem_artifact.54 days = 60 }
			}
		}
	}
	
	option = {
		name = mem_artifact.53.b	
	}
}

#Enable Storm Clouds

country_event = {
	id = mem_artifact.54
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_alt_ward_1
				}
				create_ambient_object = {
				type = "mem_artifact_station_alt_2_object"
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_alt_2_ward_1
				}
				destroy_ambient_object = this
			}
			every_system_ambient_object= {
				limit = {
					has_ambient_object_flag = mem_artifact_alt_ward_2
				}
				create_ambient_object = {
				type = "mem_artifact_station_alt_2_object"
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_alt_2_ward_2
				}
				destroy_ambient_object = this
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_alt_ward_3
				}
				create_ambient_object = {
				type = "mem_artifact_station_alt_2_object"
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_alt_2_ward_3
				}
				destroy_ambient_object = this
			}
			create_ambient_object = {
			type = "mem_cloud_ambient_alt_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:mem_artifact_relic_loc
					distance = 0
					angle = 0
				}
				set_ambient_object_flag = mem_gate_system_storm
			}
		}
		country_event = { id = mem_artifact.55 days = 60 }
	}
}

#Boss Encounter Spawn

country_event = {
	id = mem_artifact.55
	title = "mem_artifact.53"
	desc = "mem_artifact.53.desc"
	picture = GFX_evt_space_station
	location = THIS
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
	}
	
	immediate = {
		create_country = {
			name = "Lament"
			type = mem_gate_guardian
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"dark_purple"
					"dark_purple"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			if = {
				limit = {
					NOT = {
						has_modifier = mem_gate_power
					}
				}
				add_modifier = {
					modifier = mem_gate_power
					days = -1
				}
			}
			save_global_event_target_as = mem_gate_country
			set_country_flag = mem_gate_country
			guardian_difficulty = yes
		}
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			set_star_flag = mem_gate_snare
			every_fleet_in_system = {
				if = {
					limit = {
						exists = this
						NOT = {
							owner = {
								has_country_flag = mem_gate_country
								is_country_type = mem_gate_guardian
							}
						}
					}
					set_location = event_target:mem_artifact_relic_loc
					add_modifier = {
						modifier = "mem_artifact_fleet_snare"
						days = 360
					}
				}
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_relic_alt_2_target
				}
				mem_effect_explosion_AOE = yes
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_alt_2_ward_1
				}
				save_event_target_as = mem_artifact_alt_ward_1_loc
			}
			every_system_ambient_object= {
				limit = {
					has_ambient_object_flag = mem_artifact_alt_2_ward_2
				}
				save_event_target_as = mem_artifact_alt_ward_2_loc
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_alt_2_ward_3
				}
				save_event_target_as = mem_artifact_alt_ward_3_loc
			}
			create_fleet = {
				name = "Shroudborn"
				settings = {
					spawn_debris = no 
					is_boss = yes
				}
				effect = {
					set_owner = event_target:mem_gate_country
					create_ship = {
						name = "An'Tu"
						design = "Var'Utr"
						prefix = no
						
						effect = {
							set_disable_at_health = 0.05	
							set_ship_flag = mem_artifact_ward_1
						}
					}
					set_location = event_target:mem_artifact_alt_ward_1_loc
				}
			}
			create_fleet = {
				name = "Shroudborn"
				settings = {
					spawn_debris = no 
					is_boss = yes
				}
				effect = {
					set_owner = event_target:mem_gate_country
					create_ship = {
						name = "Go'Pa"
						design = "Var'Utr"
						prefix = no
						
						effect = {
							set_disable_at_health = 0.05	
							set_ship_flag = mem_artifact_ward_2
						}
					}
					set_location = event_target:mem_artifact_alt_ward_2_loc
				}
			}
			create_fleet = {
				name = "Shroudborn"
				settings = {
					spawn_debris = no 
					is_boss = yes
				}
				effect = {
					set_owner = event_target:mem_gate_country
					create_ship = {
						name = "Pa'Ra"
						design = "Var'Utr"
						prefix = no
						
						effect = {
							set_disable_at_health = 0.05
							set_ship_flag = mem_artifact_ward_3
						}
					}
					set_location = event_target:mem_artifact_alt_ward_3_loc
				}
			}
			every_system_ambient_object = {
				limit = {
					OR = {
						has_ambient_object_flag = mem_artifact_alt_2_ward_1
						has_ambient_object_flag = mem_artifact_alt_2_ward_2
						has_ambient_object_flag = mem_artifact_alt_2_ward_3
					}
				}
				destroy_ambient_object = this
			}
		}
		set_global_flag = mem_artifact_awakening
	}
}

#Boss Encounter Snare

fleet_event = {
	id = mem_artifact.56
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			AND = {
				has_star_flag = mem_gate_snare
				has_star_flag = mem_gate_system
			}
		}
	}
	
	immediate = {
		set_location = event_target:mem_artifact_relic_loc
		add_modifier = {
			modifier = "mem_artifact_fleet_snare"
			days = 360
		}
	}
}

#Tower Destroyed - Spawn Avatar & Interrupt Snare

ship_event = {
	id = mem_artifact.57
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ship_size = mem_artifact_station
		OWNER = {
			is_country_type = mem_gate_guardian
			has_country_flag = mem_gate_country
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			if = {
				limit = {
					has_star_flag = mem_gate_snare
				}
				remove_star_flag = mem_gate_snare
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_relic_alt_2_target
				}
				create_ambient_object = {
					type = mem_artifact_pulse_object
					location = this
					duration = 4
						
					use_3d_location = yes
						
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
						
					entity_scale_to_size = no
					scale = 1
				}
			}
		}
		if = {
			limit = {
				exists = this
				has_ship_flag = mem_artifact_ward_1
			}
			create_ambient_object = {
			type = "mem_artifact_station_alt_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = this
					distance = 0
					angle = 0
				}
				set_ambient_object_flag = mem_artifact_alt_ward_1_reset
			}
			create_fleet = {
				name = "Shroudborn"
				settings = {
					spawn_debris = no
					is_boss = yes
				}
				effect = {
					set_owner = event_target:mem_gate_country
					create_ship = {
						name = "Ai'Za"
						design = "Ru'Ha"
						prefix = no
						
						effect = {
							set_ship_flag = mem_artifact_shroudborn_1
						}
					}
					set_location = event_target:mem_artifact_relic_loc
					set_fleet_stance = aggressive
					set_aggro_range = 500
					set_aggro_range_measure_from = self
				}
			}
			fleet = {
				delete_fleet = this
			}
			break = yes
		}
		if = {
			limit = {
				exists = this
				has_ship_flag = mem_artifact_ward_2
			}
			create_ambient_object = {
			type = "mem_artifact_station_alt_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = this
					distance = 0
					angle = 0
				}
				set_ambient_object_flag = mem_artifact_alt_ward_2_reset
			}
			create_fleet = {
				name = "Shroudborn"
				settings = {
					spawn_debris = no
					is_boss = yes
				}
				effect = {
					set_owner = event_target:mem_gate_country
					create_ship = {
						name = "Sau'Ra"
						design = "Ru'Ha"
						prefix = no
						
						effect = {
							set_ship_flag = mem_artifact_shroudborn_2
						}
					}
					set_location = event_target:mem_artifact_relic_loc
					set_fleet_stance = aggressive
					set_aggro_range = 500
					set_aggro_range_measure_from = self
				}
			}
			fleet = {
				delete_fleet = this
			}
			break = yes
		}
		if = {
			limit = {
				exists = this
				has_ship_flag = mem_artifact_ward_3
			}
			create_ambient_object = {
			type = "mem_artifact_station_alt_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = this
					distance = 0
					angle = 0
				}
				set_ambient_object_flag = mem_artifact_alt_ward_3_reset
			}
			create_fleet = {
				name = "Shroudborn"
				settings = {
					spawn_debris = no
					is_boss = yes
				}
				effect = {
					set_owner = event_target:mem_gate_country
					create_ship = {
						name = "Yaj'Jiya"
						design = "Ru'Ha"
						prefix = no
						
						effect = {
							set_ship_flag = mem_artifact_shroudborn_3
						}
					}
					set_location = event_target:mem_artifact_relic_loc
					set_fleet_stance = aggressive
					set_aggro_range = 500
					set_aggro_range_measure_from = self
				}
			}
			fleet = {
				delete_fleet = this
			}
			break = yes
		}
	}
}

#Specter defeated

country_event = {
	id = mem_artifact.60
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = mem_gate_country
		is_country_type = mem_gate_guardian
		FROMFROM = {
			is_ship_size = mem_artifact_shroudborn
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_flag = mem_shroudborn_1_slain
				}
				FROMFROM = {
					has_ship_flag = mem_artifact_shroudborn_1
				}
			}
			set_global_flag = mem_shroudborn_1_slain
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_global_flag = mem_shroudborn_2_slain
				}
				FROMFROM = {
					has_ship_flag = mem_artifact_shroudborn_2
				}
			}
			set_global_flag = mem_shroudborn_2_slain
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_global_flag = mem_shroudborn_3_slain
				}
				FROMFROM = {
					has_ship_flag = mem_artifact_shroudborn_3
				}
			}
			set_global_flag = mem_shroudborn_3_slain
			break = yes
		}
	}
}

#Encounter Clear

country_event = {
	id = mem_artifact.61
	hide_window = yes
	
	trigger = {
		AND ={
			has_global_flag = mem_shroudborn_1_slain
			has_global_flag = mem_shroudborn_2_slain
			has_global_flag = mem_shroudborn_3_slain
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_gate_system
			}
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = mem_artifact_relic_alt_2_target
				}
				mem_effect_explosion_AOE = yes
				create_ambient_object = {
					type = mem_artifact_pulse_object
					location = this
					duration = 4
						
					use_3d_location = yes
						
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
						
					entity_scale_to_size = no
					scale = 4
				}
				create_ambient_object = {
				type = "mem_artifact_relic_object"
				}
				last_created_ambient_object = {
					set_location = {
						target = this
						distance = 0
						angle = 0
					}
					set_ambient_object_flag = mem_artifact_activated_relic
				}
				destroy_ambient_object = this
			}
			every_system_ambient_object = {
				limit = {
					OR = {
						has_ambient_object_flag = mem_artifact_alt_ward_1_reset
						has_ambient_object_flag = mem_artifact_alt_ward_2_reset
						has_ambient_object_flag = mem_artifact_alt_ward_3_reset
						has_ambient_object_flag = mem_artifact_relic_fog
						has_ambient_object_flag = mem_gate_system_storm
					}
				}
				destroy_ambient_object = this
			}
		}
	}
}

